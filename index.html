<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>EKR Kalkulátor – 18/2025. (VII. 31.) EM rendelet</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Merriweather:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #121212; --card: #1e1e1e; --surface: #2a2a2a;
      --text: #f5f5f5; --accent: #ffbf00; --accent-dark: #d9a500;
      --br: 10px;
    }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin:0; padding:20px; }
    header { font-family: 'Merriweather', serif; font-size:14px; color:var(--accent); margin-bottom:10px; }
    h1 { color:var(--accent); margin-bottom:20px; }
    .card { background:var(--card); border-radius:var(--br); padding:20px; margin-bottom:20px; box-shadow:0 4px 12px rgba(0,0,0,.6); }
    label { display:block; margin-top:10px; font-weight:600; }
    select,input { width:100%; padding:10px; margin-top:5px; border:1px solid #444; border-radius:var(--br); background:var(--surface); color:var(--text); font-size:14px; }
    select:focus,input:focus { outline:none; border-color:var(--accent); }
    button { margin-top:15px; padding:12px 20px; border:none; border-radius:var(--br); background:var(--accent); color:#000; font-size:16px; font-weight:600; cursor:pointer; }
    button:hover { background:var(--accent-dark); }
    .result { background:var(--surface); border:1px solid var(--accent); border-radius:var(--br); padding:20px; margin-top:20px; }
    .highlight { font-size:20px; font-weight:700; color:var(--accent); margin-bottom:15px; }
    table { width:100%; border-collapse:collapse; margin-top:15px; }
    th,td { padding:8px; text-align:right; border-bottom:1px solid #333; font-size:13px; }
    th { background:var(--accent); color:#000; }
    tr:nth-child(even){background:#222;} tr:nth-child(odd){background:#1a1a1a;}
    .left { text-align:left; }
  </style>
</head>
<body>
  <header>Copyright © 2025 Wattmanager Kft.</header>
  <h1>EKR Kalkulátor</h1>

  <div class="card">
    <label for="measure">Intézkedés típusa:</label>
    <select id="measure">
      <option value="1.3">1.3. Családi ház hőszigetelés</option>
      <option value="1.4">1.4. Családi ház nyílászáró csere</option>
      <option value="1.5">1.5. Társasház hőszigetelés</option>
      <option value="1.6">1.6. Társasház nyílászáró csere</option>
      <option value="2.1">2.1. Gázkazán csere hőszivattyúra</option>
      <option value="2.5">2.5. Split klímaberendezés kiegészítő fűtésre</option>
    </select>

    <div id="inputs"></div>
    <button onclick="calculate()">Számítás</button>
  </div>

  <div id="result"></div>

<script>
const num = v => { const x=(v||"").toString().replace(",",".").trim(); const n=Number(x); return Number.isFinite(n)?n:0; };
const de_nyilaszaro={"fa_1989":1.08,"acel_1980":1.50,"fa_1990":0.41,"muanyag_2000":0.32};

function showInputs(measure){
  let html="";
  if(measure==="1.3"||measure==="1.5"){
    html+=`<label>Szerkezet típusa</label><select id="szerk"><option value="fal">Homlokzati fal</option><option value="teto">Padlásfödém/tető</option></select>
    <label>Felület (m²)</label><input id="area" type="number">`;
  }
  if(measure==="1.4"||measure==="1.6"){
    html+=`<label>Nyílászáró típusa</label><select id="nyil">
      <option value="fa_1989">Fa (≤1989)</option><option value="acel_1980">Acél (≤1980)</option>
      <option value="fa_1990">Fa (1990–1999)</option><option value="muanyag_2000">Műanyag (2000–2006)</option></select>
    <label>Felület (m²)</label><input id="area" type="number">`;
  }
  if(measure==="2.1"){
    html+=`<label>Épület típusa</label><select id="epulet"><option value="csaladi">Családi ház</option><option value="tars_kis">&lt;10 lakásos társasház</option><option value="tars_nagy">&ge;10 lakásos társasház</option></select>
    <label>Af – Fűtött alapterület (m²)</label><input id="Af" type="number">
    <label>Kazán beépítés éve</label><input id="ev_kazan" type="number">
    <label>Beruházás éve</label><input id="year" type="number">
    <label>Ck – régi kazán hatásfoka</label><input id="Ck" type="number" step="0.01" placeholder="pl. 0.85">
    <label>SCOP ref – referencia hőszivattyú SCOP</label><input id="SCOPref" type="number" step="0.1" placeholder="pl. 3.0">
    <label>SCOP új – új hőszivattyú SCOP</label><input id="SCOPuj" type="number" step="0.1" placeholder="pl. 4.0">`;
  }
  if(measure==="2.5"){
    html+=`<label>Épület típusa</label><select id="epulet"><option value="csaladi">Családi ház</option><option value="tars_kis">&lt;10 lakásos társasház</option><option value="tars_nagy">&ge;10 lakásos társasház</option></select>
    <label>As – Egybefüggő légterű alapterület [m²]</label><input id="As" type="number">
    <label>Ps – Névleges fűtési teljesítmény [kW]</label><input id="Ps" type="number">
    <label>Pc – Névleges hűtési teljesítmény [kW]</label><input id="Pc" type="number">
    <label>SCOP</label><input id="SCOP" type="number">
    <label>SEER</label><input id="SEER" type="number">
    <label>Beruházás éve</label><input id="year" type="number">`;
  }
  document.getElementById("inputs").innerHTML=html;
}
document.getElementById("measure").addEventListener("change",e=>showInputs(e.target.value));
showInputs(document.getElementById("measure").value);

function calculate(){
  const measure=document.getElementById("measure").value;
  const year=num(document.getElementById("year")?.value);
  let html="<div class='result'>";
  
  // ---- 1.3 és 1.5 ----
  if(measure==="1.3"||measure==="1.5"){
    const area=num(document.getElementById("area").value);
    const szerk=document.getElementById("szerk").value;
    let de=0.461; if(measure==="1.5"&&szerk==="fal")de=0.40;
    const baseSaving=area*de;
    html+=`<div class="highlight">Átlagos éves megtakarítás: ${baseSaving.toFixed(2)} GJ/év</div>`;
  }
  // ---- 1.4 és 1.6 ----
  if(measure==="1.4"||measure==="1.6"){
    const area=num(document.getElementById("area").value);
    const nyil=document.getElementById("nyil").value;
    const de=de_nyilaszaro[nyil];
    const baseSaving=area*de;
    html+=`<div class="highlight">Átlagos éves megtakarítás: ${baseSaving.toFixed(2)} GJ/év</div>`;
  }
  // ---- 2.1 ----
  if(measure==="2.1"){
    const Af=num(document.getElementById("Af").value);
    const ep=document.getElementById("epulet").value;
    const ev_kazan=num(document.getElementById("ev_kazan").value);
    const Ck=num(document.getElementById("Ck").value);
    const SCOPref=num(document.getElementById("SCOPref").value);
    const SCOPuj=num(document.getElementById("SCOPuj").value);
    let qf=0; if(ep==="csaladi")qf=139.5; if(ep==="tars_kis")qf=96; if(ep==="tars_nagy")qf=67.5;
    const Qh=qf*Af; const lifetime=20;
    let total=0,yearsCount=0,korai=0,kesoi=0;
    let table=`<table><tr><th>Év</th><th>Megtakarítás (GJ)</th><th>Típus</th></tr>`;
    for(let y=year;y<=2031;y++){
      const ageKaz=y-ev_kazan; let s=0,tipus="";
      if(ageKaz<lifetime){ s=Qh*(Ck-1/(SCOPuj||1))*3.6/1000; tipus="Korai csere"; korai++; }
      else { s=Qh*((1/(SCOPref||1))-(1/(SCOPuj||1)))*3.6/1000; tipus="Késői csere"; kesoi++; }
      total+=s; yearsCount++;
      table+=`<tr><td>${y}</td><td>${s.toFixed(2)}</td><td>${tipus}</td></tr>`;
    }
    table+=`<tr><td class="left">Σ</td><td>${total.toFixed(2)}</td><td>Korai: ${korai} • Késői: ${kesoi}</td></tr></table>`;
    html+=`<div class="highlight">Átlagos éves megtakarítás: ${(total/yearsCount).toFixed(2)} GJ/év</div>`+table;
  }
  // ---- 2.5 ----
  if(measure==="2.5"){
    const As=num(document.getElementById("As").value);
    const Ps=num(document.getElementById("Ps").value);
    const Pc=num(document.getElementById("Pc").value);
    const SCOP=num(document.getElementById("SCOP").value);
    const SEER=num(document.getElementById("SEER").value);
    const ep=document.getElementById("epulet").value;
    let qf=0; if(ep==="csaladi")qf=139.5; if(ep==="tars_kis")qf=96; if(ep==="tars_nagy")qf=67.5;
    const Qhoigeny=qf*As;
    const adatTabla=[[-15,0],[-14,0],[-13,0],[-12,0],[-11,0],[-10,1],[-9,4],[-8,15],[-7,28],[-6,51],[-5,74],[-4,111],[-3,168],[-2,193],[-1,239],[0,295],[1,319],[2,358],[3,308],[4,279],[5,231],[6,292],[7,302],[8,311],[9,315],[10,300],[11,321],[12,265]];
    const Tb=20; let sumH=0; for(const [Tk,Zi] of adatTabla) sumH+=Zi*(Tb-Tk);
    let sumQh=0,sumQs=0,sumQE=0; let rows=[];
    for(const [Tk,Zi] of adatTabla){
      const Hstd=Zi*(Tb-Tk);
      const Qh_i=Qhoigeny*(Hstd/sumH);
      let Qs_i=null,QE_i=null;
      if(Tk>=-2&&Tk<=12){ Qs_i=Ps*Zi; QE_i=Math.min(Qh_i,Qs_i); sumQs+=Qs_i; sumQE+=QE_i; }
      sumQh+=Qh_i; rows.push({Tk,Zi,Hstd,Qh_i,Qs_i,QE_i});
    }
    const Qemax=Ps*2100; const QEfigy=Math.min(sumQE,Qemax);
    const tc=350; const DeltaE=(QEfigy*(1-1/(SCOP||1))-(Pc*tc/(SEER||1)))*3.6/1000;
    const lifetime=10,avul=0.0025;
    let total=0,yearsCount=0;
    let table=`<table><tr><th>Év</th><th>Megtakarítás (GJ)</th></tr>`;
    for(let y=year;y<=2031;y++){ let age=y-year; if(age>lifetime) break;
      let s=DeltaE*Math.pow(1-avul,age); total+=s; yearsCount++;
      table+=`<tr><td>${y}</td><td>${s.toFixed(2)}</td></tr>`;
    }
    table+=`<tr><td class="left">Σ</td><td>${total.toFixed(2)}</td></tr></table>`;
    html+=`<div class="highlight">Átlagos éves megtakarítás: ${(total/yearsCount).toFixed(2)} GJ/év</div>
           <p><b>ΔE (megtakarítás):</b> ${DeltaE.toFixed(2)} GJ/év<br>
           <b>QE,max:</b> ${Qemax.toFixed(2)} kWh/év<br>
           <b>QE,figyelembevett:</b> ${QEfigy.toFixed(2)} kWh/év</p>`+table;
    // Részletes Tk–Zi
    let detail=`<h3>Részletes Tk–Zi táblázat</h3><table><tr><th class="left">Tk [°C]</th><th>Zi [h]</th><th>Hstd</th><th>Qhőigény,i</th><th>Qsplit,i</th><th>QE,i</th></tr>`;
    const fmt=v=>Number.isFinite(v)?v.toFixed(2):"-";
    for(const r of rows){
      detail+=`<tr><td class="left">${r.Tk}</td><td>${r.Zi}</td><td>${fmt(r.Hstd)}</td><td>${fmt(r.Qh_i)}</td><td>${r.Qs_i!==null?fmt(r.Qs_i):"-"}</td><td>${r.QE_i!==null?fmt(r.QE_i):"-"}</td></tr>`;
    }
    detail+=`<tr><td class="left" colspan="3">Σ összesen</td><td>${fmt(sumQh)}</td><td>${fmt(sumQs)}</td><td>${fmt(sumQE)}</td></tr></table>`;
    html+=detail;
  }
  html+="</div>"; document.getElementById("result").innerHTML=html;
}
</script>
</body>
</html>
